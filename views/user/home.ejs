<%- include('../layouts/header.ejs') %>
    <%- include('../layouts/navbar.ejs') %>
        <%- include('../layouts/quickView.ejs') %>

            <body>

                <main class="main">
                    <!-- this for slider -->
                    <section class="home-slider position-relative pt-40 pb-20">
                        <div class="container">
                            <div class="col-12">
                                <div class="position-relative">
                                    <div class="hero-slider-1 style-3 dot-style-1 dot-style-1-position-1">
                                        <% banners.forEach(banner=> { %>
                                            <div class="single-hero-slider single-animation-wrap ">
                                                <div class="container">
                                                    <div class="slider-1-height-3 slider-animated-1">
                                                        <div class="hero-slider-content-2">
                                                            <h2 class="animated fw-900 text-white ml-20 ">
                                                                <%= banner.title %>
                                                            </h2>
                                                            <p class="animated text-white fw-400 ml-20"
                                                                style="font-size: 20px;">
                                                                <%= banner.description %>
                                                            </p>
                                                            <a class="animated btn btn-sm  ml-20"
                                                            href="<%= banner.link %>">Shop Now</a>
                                                        </div>
                                                        <div class="slider-img" style="position: absolute; 
                                                               width: 100%; 
                                                               height: 100%; 
                                                               z-index: 1;">
                                                            <img src="/uploads/banner/<%= banner.bannerImage %>"
                                                                alt="Banner" style="object-fit: cover;
                                                                   width: 100%;
                                                                   height: 100%;
                                                                   opacity: 0.9;">
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <% }) %>
                                    </div>
                                    <div class="slider-arrow hero-slider-1-arrow style-3"></div>
                                </div>
                            </div>
                    </section>

                    <!-- this for box iteam-->
                    <section class="featured section-padding ">
                        <div class="container">
                            <div class="row">
                                <div class="col-lg-2 col-md-4 mb-md-3 mb-lg-0">
                                    <div class="banner-features wow fadeIn animated hover-up animated">
                                        <img src="/imgs/theme/icons/feature-1.png" alt="">
                                        <h4 class="bg-1">Free Shipping</h4>
                                    </div>
                                </div>
                                <div class="col-lg-2 col-md-4 mb-md-3 mb-lg-0">
                                    <div class="banner-features wow fadeIn animated hover-up animated">
                                        <img src="/imgs/theme/icons/feature-2.png" alt="">
                                        <h4 class="bg-3">Online Order</h4>
                                    </div>
                                </div>
                                <div class="col-lg-2 col-md-4 mb-md-3 mb-lg-0">
                                    <div class="banner-features wow fadeIn animated hover-up animated">
                                        <img src="/imgs/theme/icons/feature-3.png" alt="">
                                        <h4 class="bg-2">Save Money</h4>
                                    </div>
                                </div>
                                <div class="col-lg-2 col-md-4 mb-md-3 mb-lg-0">
                                    <div class="banner-features wow fadeIn animated hover-up animated">
                                        <img src="/imgs/theme/icons/feature-4.png" alt="">
                                        <h4 class="bg-4">Promotions</h4>
                                    </div>
                                </div>
                                <div class="col-lg-2 col-md-4 mb-md-3 mb-lg-0">
                                    <div class="banner-features wow fadeIn animated hover-up animated">
                                        <img src="/imgs/theme/icons/feature-5.png" alt="">
                                        <h4 class="bg-5">Happy Sell</h4>
                                    </div>
                                </div>
                                <div class="col-lg-2 col-md-4 mb-md-3 mb-lg-0">
                                    <div class="banner-features wow fadeIn animated hover-up animated">
                                        <img src="/imgs/theme/icons/feature-6.png" alt="">
                                        <h4 class="bg-6">24/7 Support</h4>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </section>


                    <!-- this for product-->
                    <section class="product-tabs section-padding wow fadeIn animated">
                        <div class="container">
                            <div class="tab-header d-flex flex-wrap justify-content-between align-items-center">
                                <ul class="nav nav-tabs" id="myTab" role="tablist">
                                    <li class="nav-item" role="presentation">
                                        <button class="nav-link active" id="nav-tab-one" data-bs-toggle="tab"
                                            data-bs-target="#tab-one" type="button" role="tab" aria-controls="tab-one"
                                            aria-selected="true">Featured</button>
                                    </li>
                                    <li class="nav-item" role="presentation">
                                        <button class="nav-link" id="nav-tab-two" data-bs-toggle="tab"
                                            data-bs-target="#tab-two" type="button" role="tab" aria-controls="tab-two"
                                            aria-selected="false">Popular</button>
                                    </li>
                                    <li class="nav-item" role="presentation">
                                        <button class="nav-link" id="nav-tab-three" data-bs-toggle="tab"
                                            data-bs-target="#tab-three" type="button" role="tab"
                                            aria-controls="tab-three" aria-selected="false">New Added</button>
                                    </li>
                                </ul>
                                <a href="/shop" class="view-more mt-2 mt-md-0 d-flex">View More Products<i
                                        class="fi-rs-angle-double-small-right"></i></a>
                            </div>

                            <div class="tab-content wow fadeIn animated" id="myTabContent">
                                <div class="tab-pane fade show active" id="tab-one" role="tabpanel"
                                    aria-labelledby="tab-one">
                                    <div class="row product-grid-4 ">
                                        <% for(let i=0; i < featuredProducts.length; i++) { %>
                                            <div class="col-lg-3 col-md-4 col-6 col-sm-6">
                                                <div class="product-cart-wrap ml-0 mt-0 m-2">
                                                    <div class="product-img-action-wrap">
                                                        <div class="product-img product-img-zoom">
                                                            <a href="/productdetails/<%= featuredProducts[i]._id %>">
                                                                <img class="default-img"
                                                                    src="/uploads/product/resized/<%= featuredProducts[i].productImage[0] %>"
                                                                    alt="">
                                                                <img class="hover-img"
                                                                    src="/uploads/product/resized/<%= featuredProducts[i].productImage[1] %>"
                                                                    alt="">
                                                            </a>
                                                        </div>
                                                        <div class="product-action-1">

                                                            <a aria-label="Quick view"
                                                                class="action-btn hover-up quick-view-btn"
                                                                data-bs-toggle="modal" data-bs-target="#quickViewModal"
                                                                data-product='<%= JSON.stringify(featuredProducts[i]) %>'>
                                                                <i class="fi-rs-eye"></i>

                                                                <% if (userWishlist.some(item=>
                                                                    item.productId.equals(featuredProducts[i]._id))) {
                                                                    %>
                                                                    <a aria-label="Add To Wishlist" class="action-btn"
                                                                        style="background-color: red;"
                                                                        onclick="addToWishList('<%= featuredProducts[i]._id %>')"><i
                                                                            class="fi-rs-heart"></i></a>
                                                                    <% } else { %>
                                                                        <a aria-label="Add To Wishlist"
                                                                            class="action-btn hover-up"
                                                                            onclick="addToWishList('<%= featuredProducts[i]._id %>')"><i
                                                                                class="fi-rs-heart"></i></a>
                                                                        <% } %>
                                                                            <!-- <a aria-label="Compare"
                                                                            class="action-btn hover-up" href="#"><i
                                                                                class="fi-rs-shuffle"></i></a> -->
                                                        </div>
                                                        <div
                                                            class="product-badges product-badges-position product-badges-mrg">
                                                            <% if(featuredProducts[i].isNewArrival) { %><span
                                                                    class="new">New</span>
                                                                <% } %>
                                                                    <% if(featuredProducts[i].isHot) { %><span
                                                                            class="hot">Hot</span>
                                                                        <% } %>
                                                                            <% if(featuredProducts[i].isBestSeller) { %>
                                                                                <span class="best">Best Sell</span>
                                                                                <% } %>
                                                        </div>
                                                    </div>
                                                    <div class="product-content-wrap">
                                                        <div class="product-category">
                                                            <a href="/productdetails/<%= featuredProducts[i]._id %>">
                                                                <% if (featuredProducts[i].category) { %>
                                                                    <p>
                                                                        <%= featuredProducts[i].category.categoryName %>
                                                                    </p>
                                                                    <% } else { %>
                                                                        <p>Category: Not specified</p>
                                                                        <% } %>
                                                            </a>
                                                        </div>
                                                        <h2>
                                                            <a href="/productdetails/<%= featuredProducts[i]._id %>">
                                                                <%= featuredProducts[i].name &&
                                                                    featuredProducts[i].name.length> 15 ?
                                                                    featuredProducts[i].name.slice(0, 15) + '...' :
                                                                    featuredProducts[i].name || '' %>
                                                            </a>
                                                        </h2>
                                                        <div class="rating-result"
                                                            data-rating="<%= featuredProducts[i].avgRating %>">
                                                            <span class="stars"></span>
                                                            <span class="percentage"></span>
                                                        </div>

                                                        <div class="product-card__price d-flex">
                                                            <% let discountedPrice=featuredProducts[i].price; %>
                                                                <% let hasDiscount=false; %>
                                                                    <% let discountPercentage=0; %>

                                                                        <% if (featuredProducts[i].offer && new Date()
                                                                            <=new
                                                                            Date(featuredProducts[i].offer.endingDate))
                                                                            { %>
                                                                            <% discountPercentage=featuredProducts[i].offer.discount;
                                                                                %>
                                                                                <% hasDiscount=true; %>
                                                                                    <% } %>

                                                                                        <% if
                                                                                            (featuredProducts[i].category.offer
                                                                                            && new Date() <=new
                                                                                            Date(featuredProducts[i].category.offer.endingDate))
                                                                                            { %>
                                                                                            <% if
                                                                                                (featuredProducts[i].category.offer.discount>
                                                                                                discountPercentage) { %>
                                                                                                <% discountPercentage=featuredProducts[i].category.offer.discount;
                                                                                                    %>
                                                                                                    <% hasDiscount=true;
                                                                                                        %>
                                                                                                        <% } %>
                                                                                                            <% } %>

                                                                                                                <% if
                                                                                                                    (hasDiscount)
                                                                                                                    { %>
                                                                                                                    <% discountedPrice
                                                                                                                        -=discountedPrice
                                                                                                                        *
                                                                                                                        (discountPercentage
                                                                                                                        /
                                                                                                                        100);
                                                                                                                        %>
                                                                                                                        <span
                                                                                                                            class="money price">
                                                                                                                            <del><strong>₹
                                                                                                                                <%= featuredProducts[i].price.toFixed(2)
                                                                                                                                    %></strong>
                                                                                                                            </del>
                                                                                                                            &nbsp;<span
                                                                                                                                class="discounted-price"
                                                                                                                                style="color: green;"><strong>₹
                                                                                                                                <%= discountedPrice.toFixed(2)
                                                                                                                                    %></strong>
                                                                                                                            </span>
                                                                                                                            &nbsp;<span
                                                                                                                                class="discounted-percentage"
                                                                                                                                style="color: red;"><strong>(
                                                                                                                                <%= discountPercentage
                                                                                                                                    %>
                                                                                                                                    %
                                                                                                                                    off)</strong>
                                                                                                                            </span>
                                                                                                                        </span>
                                                                                                                        <% } else
                                                                                                                            {
                                                                                                                            %>
                                                                                                                            <span
                                                                                                                                 style="color: green;"><strong>₹
                                                                                                                                <%= featuredProducts[i].price.toFixed(2)
                                                                                                                                    %></strong>
                                                                                                                            </span>
                                                                                                                            <% }
                                                                                                                                %>
                                                        </div>

                                                        <div class="product-action-1 show">
                                                            <button aria-label="Add To Cart" class="action-btn hover-up"
                                                                onclick="addToCart('<%= featuredProducts[i]._id %>', '<%= featuredProducts[i].name %>', '<%= featuredProducts[i].price %>')">
                                                                <i class="fi-rs-shopping-bag-add"></i>
                                                            </button>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <% } %>
                                    </div>
                                </div>

                                <div class="tab-pane fade show " id="tab-two" role="tabpanel" aria-labelledby="tab-two">
                                    <div class="row product-grid-4">
                                        <% for(let i=0; i < bestSellerProducts.length; i++) { %>
                                            <div class="col-lg-3 col-md-4 col-6 col-sm-6">
                                                <div class="product-cart-wrap ml-0 mt-0 m-2">
                                                    <div class="product-img-action-wrap">
                                                        <div class="product-img product-img-zoom">
                                                            <a href="/productdetails/<%= bestSellerProducts[i]._id %>">
                                                                <img class="default-img"
                                                                    src="/uploads/product/resized/<%= bestSellerProducts[i].productImage[0] %>"
                                                                    alt="">
                                                                <img class="hover-img"
                                                                    src="/uploads/product/resized/<%= bestSellerProducts[i].productImage[1] %>"
                                                                    alt="">
                                                            </a>
                                                        </div>
                                                        <div class="product-action-1">

                                                            <a aria-label="Quick view"
                                                                class="action-btn hover-up quick-view-btn"
                                                                data-bs-toggle="modal" data-bs-target="#quickViewModal"
                                                                data-product='<%= JSON.stringify(bestSellerProducts[i]) %>'>
                                                                <i class="fi-rs-eye"></i>

                                                                <% if (userWishlist.some(item=>
                                                                    item.productId.equals(bestSellerProducts[i]._id))) {
                                                                    %>
                                                                    <a aria-label="Add To Wishlist" class="action-btn"
                                                                        style="background-color: red;"
                                                                        onclick="addToWishList('<%= bestSellerProducts[i]._id %>')"><i
                                                                            class="fi-rs-heart"></i></a>
                                                                    <% } else { %>
                                                                        <a aria-label="Add To Wishlist"
                                                                            class="action-btn hover-up"
                                                                            onclick="addToWishList('<%= bestSellerProducts[i]._id %>')"><i
                                                                                class="fi-rs-heart"></i></a>
                                                                        <% } %>
                                                                            <!-- <a aria-label="Compare"
                                                                                class="action-btn hover-up" href="#"><i
                                                                                    class="fi-rs-shuffle"></i></a> -->
                                                        </div>
                                                        <div
                                                            class="product-badges product-badges-position product-badges-mrg">
                                                            <% if(bestSellerProducts[i].isNewArrival) { %><span
                                                                    class="new">New</span>
                                                                <% } %>
                                                                    <% if(bestSellerProducts[i].isHot) { %><span
                                                                            class="hot">Hot</span>
                                                                        <% } %>
                                                                            <% if(bestSellerProducts[i].isBestSeller) {
                                                                                %>
                                                                                <span class="best">Best Sell</span>
                                                                                <% } %>
                                                        </div>
                                                    </div>
                                                    <div class="product-content-wrap">
                                                        <div class="product-category">
                                                            <a href="/productdetails/<%= bestSellerProducts[i]._id %>">
                                                                <% if (bestSellerProducts[i].category) { %>
                                                                    <p>
                                                                        <%= bestSellerProducts[i].category.categoryName
                                                                            %>
                                                                    </p>
                                                                    <% } else { %>
                                                                        <p>Category: Not specified</p>
                                                                        <% } %>
                                                            </a>
                                                        </div>
                                                        <h2><a href="/productdetails/<%= bestSellerProducts[i]._id %>">
                                                                <%= bestSellerProducts[i].name &&
                                                                    bestSellerProducts[i].name.length> 15 ?
                                                                    bestSellerProducts[i].name.slice(0, 15) + '...' :
                                                                    bestSellerProducts[i].name || '' %>

                                                            </a></h2>

                                                        <div class="rating-result"
                                                            data-rating="<%= bestSellerProducts[i].avgRating %>">
                                                            <span class="stars"></span>
                                                            <span class="percentage"></span>
                                                        </div>

                                                        <div class="product-card__price d-flex">
                                                            <% let discountedPrice=bestSellerProducts[i].price; %>
                                                                <% let hasDiscount=false; %>
                                                                    <% let discountPercentage=0; %>

                                                                        <% if (bestSellerProducts[i].offer && new Date()
                                                                            <=new
                                                                            Date(bestSellerProducts[i].offer.endingDate))
                                                                            { %>
                                                                            <% discountPercentage=bestSellerProducts[i].offer.discount;
                                                                                %>
                                                                                <% hasDiscount=true; %>
                                                                                    <% } %>

                                                                                        <% if
                                                                                            (bestSellerProducts[i].category.offer
                                                                                            && new Date() <=new
                                                                                            Date(bestSellerProducts[i].category.offer.endingDate))
                                                                                            { %>
                                                                                            <% if
                                                                                                (bestSellerProducts[i].category.offer.discount>
                                                                                                discountPercentage) { %>
                                                                                                <% discountPercentage=bestSellerProducts[i].category.offer.discount;
                                                                                                    %>
                                                                                                    <% hasDiscount=true;
                                                                                                        %>
                                                                                                        <% } %>
                                                                                                            <% } %>

                                                                                                                <% if
                                                                                                                    (hasDiscount)
                                                                                                                    { %>
                                                                                                                    <% discountedPrice
                                                                                                                        -=discountedPrice
                                                                                                                        *
                                                                                                                        (discountPercentage
                                                                                                                        /
                                                                                                                        100);
                                                                                                                        %>
                                                                                                                        <span
                                                                                                                            class="money price">
                                                                                                                            <del><strong>₹
                                                                                                                                <%= bestSellerProducts[i].price.toFixed(2)
                                                                                                                                    %></strong>
                                                                                                                            </del>
                                                                                                                            &nbsp;<span
                                                                                                                                class="discounted-price"
                                                                                                                                style="color: green;"><strong>₹
                                                                                                                                <%= discountedPrice.toFixed(2)
                                                                                                                                    %></strong>
                                                                                                                            </span>
                                                                                                                            &nbsp;<span
                                                                                                                                class="discounted-percentage"
                                                                                                                                style="color: red;"><strong>(
                                                                                                                                <%= discountPercentage
                                                                                                                                    %>
                                                                                                                                    %
                                                                                                                                    off)</strong>
                                                                                                                            </span>
                                                                                                                        </span>
                                                                                                                        <% } else
                                                                                                                            {
                                                                                                                            %>
                                                                                                                            <span
                                                                                                                            style="color: green;"><strong>₹
                                                                                                                                <%= bestSellerProducts[i].price.toFixed(2)
                                                                                                                                    %></strong>
                                                                                                                            </span>
                                                                                                                            <% }
                                                                                                                                %>
                                                        </div>

                                                        <div class="product-action-1 show">
                                                            <button aria-label="Add To Cart" class="action-btn hover-up"
                                                                onclick="addToCart('<%= bestSellerProducts[i]._id %>', '<%= bestSellerProducts[i].name %>', '<%= bestSellerProducts[i].price %>')">
                                                                <i class="fi-rs-shopping-bag-add"></i>
                                                            </button>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <% } %>
                                    </div>
                                </div>

                                <div class="tab-pane fade show " id="tab-three" role="tabpanel"
                                    aria-labelledby="tab-three">
                                    <div class="row product-grid-4">
                                        <% for(let i=0; i < newProducts.length; i++) { %>
                                            <div class="col-lg-3 col-md-4 col-6 col-sm-6">
                                                <div class="product-cart-wrap ml-0 mt-0 m-2">
                                                    <div class="product-img-action-wrap">
                                                        <div class="product-img product-img-zoom">
                                                            <a href="/productdetails/<%= newProducts[i]._id %>">
                                                                <img class="default-img"
                                                                    src="/uploads/product/resized/<%= newProducts[i].productImage[0] %>"
                                                                    alt="">
                                                                <img class="hover-img"
                                                                    src="/uploads/product/resized/<%= newProducts[i].productImage[1] %>"
                                                                    alt="">
                                                            </a>
                                                        </div>
                                                        <div class="product-action-1">

                                                            <a aria-label="Quick view"
                                                                class="action-btn hover-up quick-view-btn"
                                                                data-bs-toggle="modal" data-bs-target="#quickViewModal"
                                                                data-product='<%= JSON.stringify(newProducts[i]) %>'>
                                                                <i class="fi-rs-eye"></i>
                                                            </a>

                                                            <% if (userWishlist.some(item=>
                                                                item.productId.equals(newProducts[i]._id))) { %>
                                                                <a aria-label="Add To Wishlist" class="action-btn"
                                                                    style="background-color: red;"
                                                                    onclick="addToWishList('<%= newProducts[i]._id %>')"><i
                                                                        class="fi-rs-heart"></i></a>
                                                                <% } else { %>
                                                                    <a aria-label="Add To Wishlist"
                                                                        class="action-btn hover-up"
                                                                        onclick="addToWishList('<%= newProducts[i]._id %>')"><i
                                                                            class="fi-rs-heart"></i></a>
                                                                    <% } %>
                                                                        <!-- <a aria-label="Compare"
                                                                            class="action-btn hover-up" href="#"><i
                                                                                class="fi-rs-shuffle"></i></a> -->
                                                        </div>
                                                        <div
                                                            class="product-badges product-badges-position product-badges-mrg">
                                                            <% if(newProducts[i].isNewArrival) { %><span
                                                                    class="new">New</span>
                                                                <% } %>
                                                                    <% if(newProducts[i].isHot) { %><span
                                                                            class="hot">Hot</span>
                                                                        <% } %>
                                                                            <% if(newProducts[i].isBestSeller) { %>
                                                                                <span class="best">Best Sell</span>
                                                                                <% } %>
                                                        </div>
                                                    </div>
                                                    <div class="product-content-wrap">
                                                        <div class="product-category">
                                                            <a href="/productdetails/<%= newProducts[i]._id %>">
                                                                <% if (newProducts[i].category) { %>
                                                                    <p>
                                                                        <%= newProducts[i].category.categoryName %>
                                                                    </p>
                                                                    <% } else { %>
                                                                        <p>Category: Not specified</p>
                                                                        <% } %>
                                                            </a>
                                                        </div>
                                                        <h2><a href="/productdetails/<%= newProducts[i]._id %>">
                                                                <%= newProducts[i].name && newProducts[i].name.length>
                                                                    15 ?
                                                                    newProducts[i].name.slice(0, 15) + '...' :
                                                                    newProducts[i].name || '' %>
                                                            </a></h2>

                                                        <div class="rating-result"
                                                            data-rating="<%= newProducts[i].avgRating %>">
                                                            <span class="stars"></span>
                                                            <span class="percentage"></span>
                                                        </div>

                                                        <div class="product-card__price d-flex">
                                                            <% let discountedPrice=newProducts[i].price; %>
                                                                <% let hasDiscount=false; %>
                                                                    <% let discountPercentage=0; %>

                                                                        <% if (newProducts[i].offer && new Date() <=new
                                                                            Date(newProducts[i].offer.endingDate)) { %>
                                                                            <% discountPercentage=newProducts[i].offer.discount;
                                                                                %>
                                                                                <% hasDiscount=true; %>
                                                                                    <% } %>

                                                                                        <% if
                                                                                            (newProducts[i].category.offer
                                                                                            && new Date() <=new
                                                                                            Date(newProducts[i].category.offer.endingDate))
                                                                                            { %>
                                                                                            <% if
                                                                                                (newProducts[i].category.offer.discount>
                                                                                                discountPercentage) { %>
                                                                                                <% discountPercentage=newProducts[i].category.offer.discount;
                                                                                                    %>
                                                                                                    <% hasDiscount=true;
                                                                                                        %>
                                                                                                        <% } %>
                                                                                                            <% } %>

                                                                                                                <% if
                                                                                                                    (hasDiscount)
                                                                                                                    { %>
                                                                                                                    <% discountedPrice
                                                                                                                        -=discountedPrice
                                                                                                                        *
                                                                                                                        (discountPercentage
                                                                                                                        /
                                                                                                                        100);
                                                                                                                        %>
                                                                                                                        <span
                                                                                                                            class="money price">
                                                                                                                            <del>₹
                                                                                                                                <strong> <%= newProducts[i].price.toFixed(2)
                                                                                                                                    %></strong>
                                                                                                                            </del>
                                                                                                                            &nbsp;<span
                                                                                                                                class="discounted-price"
                                                                                                                                style="color: green;"><strong>₹
                                                                                                                                <%= discountedPrice.toFixed(2)
                                                                                                                                    %></strong>
                                                                                                                            </span>
                                                                                                                            &nbsp;<span
                                                                                                                                class="discounted-percentage"
                                                                                                                                style="color: red;"><strong>(
                                                                                                                                     <%= discountPercentage
                                                                                                                                    %>
                                                                                                                                    %
                                                                                                                                    off)</strong>
                                                                                                                            </span>
                                                                                                                        </span>
                                                                                                                        <% } else
                                                                                                                            {
                                                                                                                            %>
                                                                                                                            <span
                                                                                                                            style="color: green;"><strong>₹
                                                                                                                                <%= newProducts[i].price.toFixed(2)
                                                                                                                                    %></strong>
                                                                                                                            </span>
                                                                                                                            <% }
                                                                                                                                %>
                                                        </div>

                                                        <div class="product-action-1 show">
                                                            <button aria-label="Add To Cart" class="action-btn hover-up"
                                                                onclick="addToCart('<%= newProducts[i]._id %>', '<%= newProducts[i].name %>', '<%= newProducts[i].price %>')">
                                                                <i class="fi-rs-shopping-bag-add"></i>
                                                            </button>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <% } %>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </section>

                    <section class="popular-categories section-padding">
                        <div class="container wow fadeIn animated">
                            <h3 class="section-title mb-20"><span>Popular</span> Categories</h3>
                            <div class="carausel-6-columns-cover position-relative">
                                <div class="slider-arrow slider-arrow-2 carausel-6-columns-arrow"
                                    id="carausel-6-columns-arrows"></div>
                                <div class="carausel-6-columns" id="carausel-6-columns">
                                    <% categories.forEach(category=> { %>
                                        <div class="card-1">
                                            <figure class=" img-hover-scale overflow-hidden">
                                                <a href="/shop?category=<%= category.categoryName %>">
                                                    <img src="uploads/category/resized/<%= category.categoryPhoto %>"
                                                        alt="<%= category.categoryName %>"></a>
                                            </figure>
                                            <h5><a href="/shop?category=<%= category.categoryName %>">
                                                    <%= category.categoryName %>

                                                </a></h5>
                                        </div>
                                        <% }) %>
                                </div>
                            </div>
                        </div>
                    </section>


                    <section class="banners section-padding">
                        <div class="container">
                            <div class="row">
                                <% topOfferCategories.forEach((category, index)=> { %>
                                    <div class="col-lg-3 col-md-4 col-6 d-flex flex-column align-items-center">
                                        <div class="banner-img wow fadeIn animated text-center">
                                            <img src="/uploads/category/resized/<%= category.categoryPhoto %>"
                                                alt="<%= category.categoryName %>" loading="lazy" height="200">
                                        </div>
                                        <div class="banner-text text-center mt-2">
                                            <span
                                                class="d-block text-uppercase font-weight-bold text-muted mt-2">Special
                                                Offer</span>
                                            <h4 class="font-weight-bold text-dark mt-2">Save <%= category.offer.discount
                                                    %>% on <%= category.categoryName %>
                                            </h4>
                                        </div>
                                        <div class="banner-text text-center mt-2">
                                            <a href="/shop?category=<%= category.categoryName %>">
                                                Shop Now <span class="ml-5"><i class="fi-rs-arrow-right"></i></span>
                                            </a>
                                        </div>
                                    </div>
                                    <% }); %>
                            </div>
                        </div>
                    </section>

                    <section class="pt-20">
                        <div class="container wow fadeIn animated">
                            <h3 class="section-title mb-20"><span>New</span> Arrivals</h3>
                            <div class="carausel-6-columns-cover position-relative">
                                <div class="slider-arrow slider-arrow-2 carausel-6-columns-arrow"
                                    id="carausel-6-columns-2-arrows"></div>
                                <div class="carausel-6-columns carausel-arrow-center" id="carausel-6-columns-2">
                                    <% for(let i=0; i < newProducts.length; i++) { %>
                                        <div class="product-cart-wrap small hover-up border me-4">
                                            <div class="product-img-action-wrap">
                                                <div class="product-img product-img-zoom">
                                                    <a href="/productdetails/<%= newProducts[i]._id %>">
                                                        <img class="default-img"
                                                            src="/uploads/product/resized/<%= newProducts[i].productImage[0] %>"
                                                            alt="">
                                                        <img class="hover-img"
                                                            src="/uploads/product/resized/<%= newProducts[i].productImage[1] %>"
                                                            alt="">
                                                    </a>
                                                </div>
                                                <div class="product-action-1">
                                                    <a aria-label="Quick view"
                                                        class="action-btn hover-up quick-view-btn"
                                                        data-bs-toggle="modal" data-bs-target="#quickViewModal"
                                                        data-product='<%= JSON.stringify(newProducts[i]) %>'>
                                                        <i class="fi-rs-eye"></i>
                                                    </a>

                                                    <% if (userWishlist.some(item=>
                                                        item.productId.equals(newProducts[i]._id))) { %>
                                                        <a aria-label="Add To Wishlist" class="action-btn"
                                                            style="background-color: red;"
                                                            onclick="addToWishList('<%= newProducts[i]._id %>')"><i
                                                                class="fi-rs-heart"></i></a>
                                                        <% } else { %>
                                                            <a aria-label="Add To Wishlist" class="action-btn hover-up"
                                                                onclick="addToWishList('<%= newProducts[i]._id %>')"><i
                                                                    class="fi-rs-heart"></i></a>
                                                            <% } %>
                                                </div>
                                                <div class="product-badges product-badges-position product-badges-mrg">
                                                    <% if(newProducts[i].isNewArrival) { %><span class="new">New</span>
                                                        <% } %>
                                                            <% if(newProducts[i].isHot) { %><span class="hot">Hot</span>
                                                                <% } %>
                                                                    <% if(newProducts[i].isBestSeller) { %>
                                                                        <span class="best">Best Sell</span>
                                                                        <% } %>
                                                </div>
                                            </div>
                                            <div class="product-content-wrap">
                                                <div class="product-category">
                                                    <a href="/productdetails/<%= newProducts[i]._id %>">
                                                        <% if (newProducts[i].category) { %>
                                                            <p>
                                                                <%= newProducts[i].category.categoryName %>
                                                            </p>
                                                            <% } else { %>
                                                                <p>Category: Not specified</p>
                                                                <% } %>
                                                    </a>
                                                </div>
                                                <h2><a href="/productdetails/<%= newProducts[i]._id %>">
                                                        <%= newProducts[i].name && newProducts[i].name.length> 15 ?
                                                            newProducts[i].name.slice(0, 15) + '...' :
                                                            newProducts[i].name || '' %>
                                                    </a></h2>

                                                <div class="rating-result"
                                                    data-rating="<%= newProducts[i].avgRating %>">
                                                    <span class="stars"></span>
                                                    <span class="percentage"></span>
                                                </div>

                                                <div class="product-card__price d-flex fw-bold fs-6">
                                                    <% let discountedPrice=newProducts[i].price; %>
                                                        <% let hasDiscount=false; %>
                                                            <% let discountPercentage=0; %>

                                                                <% if (newProducts[i].offer && new Date() <=new
                                                                    Date(newProducts[i].offer.endingDate)) { %>
                                                                    <% discountPercentage=newProducts[i].offer.discount;
                                                                        %>
                                                                        <% hasDiscount=true; %>
                                                                            <% } %>

                                                                                <% if (newProducts[i].category.offer &&
                                                                                    new Date() <=new
                                                                                    Date(newProducts[i].category.offer.endingDate))
                                                                                    { %>
                                                                                    <% if
                                                                                        (newProducts[i].category.offer.discount>
                                                                                        discountPercentage) { %>
                                                                                        <% discountPercentage=newProducts[i].category.offer.discount;
                                                                                            %>
                                                                                            <% hasDiscount=true; %>
                                                                                                <% } %>
                                                                                                    <% } %>

                                                                                                        <% if
                                                                                                            (hasDiscount)
                                                                                                            { %>
                                                                                                            <% discountedPrice
                                                                                                                -=discountedPrice
                                                                                                                *
                                                                                                                (discountPercentage
                                                                                                                / 100);
                                                                                                                %>
                                                                                                                <span
                                                                                                                    class="money price">
                                                                                                                    <del>₹
                                                                                                                        <%= newProducts[i].price.toFixed(2)
                                                                                                                            %>
                                                                                                                    </del>
                                                                                                                    &nbsp;<span
                                                                                                                        class="discounted-price"
                                                                                                                        style="color: green;">₹
                                                                                                                        <%= discountedPrice.toFixed(2)
                                                                                                                            %>
                                                                                                                    </span> <br>
                                                                                                                    &nbsp;<span
                                                                                                                        class="discounted-percentage"
                                                                                                                        style="color: red;">(
                                                                                                                        <%= discountPercentage
                                                                                                                            %>
                                                                                                                            %
                                                                                                                            off)
                                                                                                                    </span>
                                                                                                                </span>
                                                                                                                <% } else
                                                                                                                    { %>
                                                                                                                        <span class="d-flex justify-content-center align-items-center w-100 text-center" style="color: green;">₹
                                                                                                                            <%= newProducts[i].price.toFixed(2) %>
                                                                                                                        </span>                                                                                                                        
                                                                                                                    <% }
                                                                                                                        %>
                                                </div>
                                                <div class="product-action-1 show">
                                                    <button aria-label="Add To Cart" class="action-btn hover-up"
                                                        onclick="addToCart('<%= newProducts[i]._id %>', '<%= newProducts[i].name %>', '<%= newProducts[i].price %>')">
                                                        <i class="fi-rs-shopping-bag-add"></i>
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                        <% } %>
                                </div>
                            </div>
                        </div>
                    </section>

                    <section class="deals section-padding mt-60">
                        <div class="container">
                            <div class="row">
                                <% topDiscountedProducts.forEach((product, index)=> { 
                                    const discountedPrice = product.price - (product.price * (product.offer ? product.offer.discount : 0) / 100);
                                %>
                                <div class="col-lg-6 deal-co">
                                    <div class="deal wow fadeIn animated position-relative overflow-hidden text-white"
                                        style="background-image: url('/uploads/product/resized/<%= product.productImage[0] %>'); background-size: cover; background-position: center; height: 300px; border-radius: 15px;">
                    
                                        <!-- Dark overlay -->
                                        <div class="overlay" style="position: absolute; inset: 0; background: rgba(0,0,0,0.6); z-index: 1;"></div>
                    
                                        <!-- Content -->
                                        <div class="deal-top position-relative" style="z-index: 2;">
                                            <h2 class="text-brand">
                                                <%= index===0 ? 'Deal of the Day' : 'Limited Time Offer' %>
                                            </h2>
                                            <h5 class="text-light">Limited quantities.</h5>
                                        </div>
                    
                                        <div class="deal-content position-relative" style="z-index: 2;">
                                            <h6 class="product-title mb-2 text-truncate" style="max-width: 100%; overflow: hidden; white-space: nowrap; text-overflow: ellipsis;">
                                                <a href="/productdetails/<%= product._id %>" class="text-white text-decoration-none d-inline-block w-100">
                                                    <%= product.name %>
                                                </a>
                                            </h6>
                                            
                                            <div class="product-card__price d-flex fs-5 align-items-center">
                                                <span class="old-price text-danger me-2"><del>₹ <%= product.price %></del></span>
                                                <span class="new-price text-success fw-bold">₹ <%= discountedPrice %></span>
                                            </div>
                                        </div>
                    
                                        <div class="deal-bottom position-relative  d-flex flex-column gap-2" style="z-index: 2;">
                                            <p class="mb-1 text-danger fw-bold">Hurry Up! Offer Ends In:</p>
                                            <div class="deals-countdown text-warning fw-bold" data-countdown="<%= product.offer ? new Date(product.offer.endingDate).toISOString() : '' %>"></div>
                                            <a href="/productdetails/<%= product._id %>" class="btn mt-2 align-self-start">Shop Now <i class="fi-rs-arrow-right"></i></a>
                                        </div>
                    
                                    </div>
                                </div>
                                <% }) %>
                            </div>
                        </div>
                    </section>
                    

                    <section class="section-padding mt-40">
                        <div class="container">
                            <h3 class="section-title mb-20 wow fadeIn animated"><span>Our</span> Brand Partners</h3>
                            <div class="carausel-6-columns-cover position-relative wow fadeIn animated">
                                <div class="slider-arrow slider-arrow-2 carausel-6-columns-arrow"
                                    id="carausel-6-columns-3-arrows"></div>
                                <div class="carausel-6-columns text-center" id="carausel-6-columns-3">
                                    <div class="brand-logo">
                                        <a href="/shop?query=the retro">
                                            <img class="img-grey-hover" src="/imgs/banner/brand-1.png" alt="brand1">
                                        </a>
                                    </div>
                                    <div class="brand-logo">
                                        <a href="/shop?query=design hub">
                                            <img class="img-grey-hover" src="/imgs/banner/brand-2.png" alt="brand2">
                                        </a>
                                    </div>
                                    <div class="brand-logo">
                                        <a href="/shop?query=travel">
                                            <img class="img-grey-hover" src="/imgs/banner/brand-3.png" alt="brand3">
                                        </a>

                                    </div>
                                    <div class="brand-logo">
                                        <a href="/shop?query=mockup">
                                            <img class="img-grey-hover" src="/imgs/banner/brand-4.png" alt="brand4">
                                        </a>
                                    </div>
                                    <div class="brand-logo">
                                        <a href="/shop?query=the backyard">
                                            <img class="img-grey-hover" src="/imgs/banner/brand-5.png" alt="brand5">
                                        </a>
                                    </div>
                                    <div class="brand-logo">
                                        <a href="/shop?query=shutter speed">
                                            <img class="img-grey-hover" src="/imgs/banner/brand-6.png" alt="brand6">
                                        </a>
                                    </div>
                                    <div class="brand-logo">
                                        <a href="/shop?query=hipster">
                                            <img class="img-grey-hover" src="/imgs/banner/brand-7.png" alt="brand7">
                                        </a>
                                    </div>
                                    <div class="brand-logo">
                                        <a href="/shop?query=new wave">
                                            <img class="img-grey-hover" src="/imgs/banner/brand-8.png" alt="brand8">
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </section>

                    <section class="section-padding  pt-60 pb-40">
                        <div class="container">
                            <div class="row">
                                <!-- Deals -->
                                <div class="col-lg-4 col-md-6 mb-sm-5 mb-md-0">
                                    <h4 class="section-title style-1 mb-30 wow fadeIn animated">Deals</h4>
                                    <div class="product-list-small wow fadeIn animated">
                                        <% featuredProducts.slice(0,4).forEach(product=> { %>
                                            <article class="row align-items-center">
                                                <figure class="col-md-4 mb-0">
                                                    <a href="/productdetails/<%= product._id %>">
                                                        <img src="/uploads/product/resized/<%= product.productImage[0] %>"
                                                            alt="<%= product.name %>">
                                                    </a>
                                                </figure>
                                                <div class="col-md-8 mb-0">
                                                    <h4 class="title-small">
                                                        <a href="/productdetails/<%= product._id %>">
                                                            <%= product.name && product.name.length> 20 ?
                                                                product.name.slice(0, 20) + '...' :
                                                                product.name || '' %>
                                                        </a>
                                                    </h4>
                                                </div>
                                            </article>
                                            <% }) %>
                                    </div>
                                </div>

                                <!-- Top Selling -->
                                <div class="col-lg-4 col-md-6 mb-sm-5 mb-md-0">
                                    <h4 class="section-title style-1 mb-30 wow fadeIn animated">Top Selling</h4>
                                    <div class="product-list-small wow fadeIn animated">
                                        <% bestSellerProducts.slice(0,4).forEach(product=> { %>
                                            <article class="row align-items-center">
                                                <figure class="col-md-4 mb-0">
                                                    <a href="/productdetails/<%= product._id %>">
                                                        <img src="/uploads/product/resized/<%= product.productImage[0] %>"
                                                            alt="<%= product.name %>">
                                                    </a>
                                                </figure>
                                                <div class="col-md-8 mb-0">
                                                    <h4 class="title-small">
                                                        <a href="/productdetails/<%= product._id %>">
                                                            <%= product.name && product.name.length> 20 ?
                                                                product.name.slice(0, 20) + '...' :
                                                                product.name || '' %>
                                                        </a>
                                                    </h4>
                                                </div>
                                            </article>
                                            <% }) %>
                                    </div>
                                </div>

                                <!-- Hot Releases -->
                                <div class="col-lg-4 col-md-6">
                                    <h4 class="section-title style-1 mb-30 wow fadeIn animated">Hot Releases</h4>
                                    <div class="product-list-small wow fadeIn animated">
                                        <% newProducts.slice(0,4).forEach(product=> { %>
                                            <article class="row align-items-center">
                                                <figure class="col-md-4 mb-0">
                                                    <a href="/productdetails/<%= product._id %>">
                                                        <img src="/uploads/product/resized/<%= product.productImage[0] %>"
                                                            alt="<%= product.name %>">
                                                    </a>
                                                </figure>
                                                <div class="col-md-8 mb-0">
                                                    <h4 class="title-small">
                                                        <a href="/productdetails/<%= product._id %>">
                                                            <%= product.name && product.name.length> 20 ?
                                                                product.name.slice(0, 20) + '...' :
                                                                product.name || '' %>
                                                        </a>
                                                    </h4>
                                                </div>
                                            </article>
                                            <% }) %>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </section>

                    <section class="banner-2 section-padding mb-60 mt-60">
                        <div class="container">
                            <div class="row">
                                <% sidebarBanners.forEach(ad=> { %>
                                    <div class="col-md-6">
                                        <div class="banner-img position-relative overflow-hidden wow fadeIn animated">
                                            <a href="<%= ad.link %>">
                                                <img src="/uploads/banner/<%= ad.bannerImage %>" alt="<%= ad.title %>" class="w-100 img-fluid">
                                            </a>
                                            <div class="banner-text position-absolute bottom-0 start-50 translate-middle-x text-center p-3 bg-opacity-50 text-white w-100">
                                                <h4 class="mb-1 fs-4 text-white fw-bold"><%= ad.title %></h4>
                                                <p class="mb-2 fs-6 text-white fw-semibold"><%= ad.description %></p>
                                                <a href="<%= ad.link %>" class="text-white fw-bold">
                                                    Shop Now <i class="fi-rs-arrow-right"></i>
                                                </a>
                                            </div>
                                        </div>
                                    </div>
                                    <% }) %>
                            </div>
                        </div>
                    </section>



                </main>
                <%- include('../layouts/footer.ejs') %>
                    <%- include('../layouts/preloader.ejs') %>
                        <%- include('../layouts/script.ejs') %>
                            <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

                            <script>
                                function addToCart(productId, name, price) {
                                    // Assuming you want to add 1 quantity by default
                                    const quantity = 1;

                                    fetch('/cart/addToCart/' + productId, {
                                        method: 'POST',
                                        headers: {
                                            'Content-Type': 'application/json',
                                        },
                                        body: JSON.stringify({ productId, name, quantity, price }),
                                    })
                                        .then(response => {
                                            if (response.redirected) {
                                                return Swal.fire({
                                                    title: 'Login Required',
                                                    text: 'You must be logged in to add items to your cart.',
                                                    icon: 'warning',
                                                    showCancelButton: true,
                                                    confirmButtonText: 'Login',
                                                    cancelButtonText: 'Cancel',
                                                }).then((result) => {
                                                    if (result.isConfirmed) {
                                                        window.location.href = '/login';
                                                    } else {
                                                        throw new Error('Action cancelled');
                                                    }
                                                });
                                            }
                                            return response.json();
                                        })

                                        .then(data => {
                                            if (data.status) {
                                                // Show a success message using SweetAlert2
                                                const Toast = Swal.mixin({
                                                    toast: true,
                                                    position: "top-end",
                                                    showConfirmButton: false,
                                                    timer: 3000,
                                                    timerProgressBar: true,
                                                    didOpen: (toast) => {
                                                        toast.onmouseenter = Swal.stopTimer;
                                                        toast.onmouseleave = Swal.resumeTimer;
                                                    }
                                                });
                                                Toast.fire({
                                                    icon: "success",
                                                    title: 'Success!',
                                                    text: data.message,
                                                });
                                                setTimeout(() => {
                                                    location.reload();
                                                }, 3000);
                                            } else {
                                                 // Handle errors
                                                 Swal.fire({
                                                     title: 'Failed!',
                                                     text: data.message,
                                                     icon: 'error',
                                                 });
                                             } 
                                        })
                                        .catch(err => {
                                            if (!err.data.success) {   
                                                Swal.fire({
                                                    icon: 'error',
                                                    title: 'Failed',
                                                    text: err.response?.data?.message || "Something went wrong.",
                                                });
                                            }
                                        });
                                }


                                function addToWishList(productId) {
                                    fetch('/wishList/addTowishList/' + productId, {
                                        method: 'POST',
                                        headers: {
                                            'Content-Type': 'application/json',
                                        },
                                        body: JSON.stringify({ productId }),
                                    })

                                        .then(response => {
                                            if (response.redirected) {
                                                return Swal.fire({
                                                    title: 'Login Required',
                                                    text: 'You must be logged in to add items to your Wishlist.',
                                                    icon: 'warning',
                                                    showCancelButton: true,
                                                    confirmButtonText: 'Login',
                                                    cancelButtonText: 'Cancel',
                                                }).then((result) => {
                                                    if (result.isConfirmed) {
                                                        window.location.href = '/login';
                                                    } else {
                                                        throw new Error('Action cancelled');
                                                    }
                                                });
                                            }
                                            return response.json();
                                        })

                                        .then(data => {
                                            if (data.status) {
                                                // Show a success message using SweetAlert2
                                                const Toast = Swal.mixin({
                                                    toast: true,
                                                    position: "top-end",
                                                    showConfirmButton: false,
                                                    timer: 3000,
                                                    timerProgressBar: true,
                                                    didOpen: (toast) => {
                                                        toast.onmouseenter = Swal.stopTimer;
                                                        toast.onmouseleave = Swal.resumeTimer;
                                                    }
                                                });
                                                Toast.fire({
                                                    icon: "success",
                                                    title: 'Success!',
                                                    text: data.message,
                                                });
                                                setTimeout(() => {
                                                    location.reload();
                                                }, 3000);
                                            } else {
                                                 // Handle errors
                                                 Swal.fire({
                                                     title: 'Failed!',
                                                     text: data.message,
                                                     icon: 'error',
                                                 });
                                             } 
                                        })
                                        .catch(err => {
                                            if (!err.data.success) {   
                                                Swal.fire({
                                                    icon: 'error',
                                                    title: 'Failed',
                                                    text:err.response?.data?.message || "Something went wrong.",
                                                });
                                            }
                                        });
                                }

                                document.addEventListener("DOMContentLoaded", function () {
                                    document.querySelectorAll(".quick-view-btn").forEach(button => {
                                        button.addEventListener("click", function () {
                                            let product = JSON.parse(this.getAttribute("data-product"));

                                            // Populate Product Info
                                            document.getElementById("quickViewName").innerText = product.name;
                                            document.getElementById("quickViewCategory").innerText = product.category.categoryName;
                                            document.getElementById("quickViewBrand").innerText = product.brand;
                                            document.getElementById("quickViewGender").innerText = product.gender;
                                            document.getElementById("quickViewSize").innerText = product.size;
                                            document.getElementById("description").innerText = product.description;


                                            let discountedPrice = product.price;
                                            let hasDiscount = false;
                                            let discountPercentage = 0;

                                            if (product.offer && new Date() <= new Date(product.offer.endingDate)) {
                                                discountPercentage = product.offer.discount;
                                                hasDiscount = true;
                                            }

                                            if (product.category.offer && new Date() <= new Date(product.category.offer.endingDate)) {
                                                if (product.category.offer.discount > discountPercentage) {
                                                    discountPercentage = product.category.offer.discount;
                                                    hasDiscount = true;
                                                }
                                            }

                                            if (hasDiscount) {
                                                discountedPrice -= discountedPrice * (discountPercentage / 100);
                                            }

                                            const priceElement = document.getElementById("quickViewPrice");
                                            priceElement.innerHTML = hasDiscount
                                                ? `<span class="money price">
                                                    <del>₹ ${product.price.toFixed(2)}</del>
                                                    &nbsp;<span class="discounted-price" style="color: green;">₹ ${discountedPrice.toFixed(2)}</span>
                                                    &nbsp;<span class="discounted-percentage" style="color: red;">(${discountPercentage}% off)</span>
                                                </span>`
                                                : `<span class="money price">₹ ${product.price.toFixed(2)}</span>`;

                                            // Stock status
                                            let stockDiv = document.getElementById("quickViewStock");
                                            stockDiv.innerHTML = product.stockCount > 0
                                                ? `<span class="badge bg-success">In Stock</span>`
                                                : `<span class="badge bg-danger">Out of Stock</span>`;

                                            // Handle Ratings and Reviews
                                            let ratingDiv = document.getElementById("quickViewRating");
                                            let averageRating = product.avgRating || 0;
                                            let totalRatings = product.totalRatings || 0;
                                            let totalReviews = product.totalReviews || 0;

                                            let ratingColor = averageRating >= 3 ? "#4CAF50" : "#F44336"; // Green if rating >= 3, Red otherwise

                                            ratingDiv.innerHTML = `
                            <div class="product-rate-cover text-end">
                                <strong>
                                    <span class="font-small m-2" style="background-color: ${ratingColor}; color: white; padding: 3px 6px; border-radius: 4px;">
                                        ${averageRating.toFixed(1)} ★
                                    </span>
                                </strong> |
                                <span class="font-small m-2 text-muted">${totalRatings} Ratings</span> |
                                <span class="font-small m-2 text-muted">${totalReviews} Reviews</span>
                            </div>
                         `;

                                            // Get Image Containers
                                            let imageContainer = document.getElementById("quickViewImages");
                                            let thumbnailContainer = document.getElementById("quickViewThumbnails");

                                            // Clear Previous Content
                                            imageContainer.innerHTML = "";
                                            thumbnailContainer.innerHTML = "";

                                            if (product.productImage.length > 0) {
                                                product.productImage.forEach((image, index) => {
                                                    let mainSlide = `
                                    <figure class="border-radius-10">
                                    <img src="/uploads/product/resized/${image}" alt="${product.name}" style="width: 100%; height: 100%; object-fit: cover;">
                                    </figure>
                                `;
                                                    imageContainer.innerHTML += mainSlide;

                                                    let thumbSlide = `
                                    <div class="thumbnail">
                                    <img src="/uploads/product/resized/${image}" alt="${product.name}" style="width: 100px; height: 100px; object-fit: fill;">
                                    </div>
                                `;
                                                    thumbnailContainer.innerHTML += thumbSlide;
                                                });
                                            }

                                            // Show the modal (if not already being triggered by another mechanism)
                                            $('#quickViewModal').modal('show');
                                        });
                                    });

                                    // Initialize the slider after the modal is fully shown
                                    $('#quickViewModal').on('shown.bs.modal', function () {
                                        // Initialize the slider for the modal gallery
                                        window.initSlickSlider($('#quickViewModal .detail-gallery'));
                                    });

                                    $('#quickViewModal').on('hidden.bs.modal', function () {
                                        var $modalGallery = $(this).find('.detail-gallery');
                                        var $productImageSlider = $modalGallery.find('.product-image-slider');
                                        var $thumbnailSlider = $modalGallery.find('.slider-nav-thumbnails');

                                        // Unslick the sliders if initialized
                                        if ($productImageSlider.hasClass('slick-initialized')) {
                                            $productImageSlider.slick('unslick');
                                        }
                                        if ($thumbnailSlider.hasClass('slick-initialized')) {
                                            $thumbnailSlider.slick('unslick');
                                        }

                                        // Optionally, clear the content if needed
                                        $productImageSlider.empty();
                                        $thumbnailSlider.empty();
                                    });

                                });

                                document.addEventListener("DOMContentLoaded", function () {
                                    document.querySelectorAll(".rating-result").forEach(ratingDiv => {
                                        let averageRating = parseFloat(ratingDiv.getAttribute("data-rating")) || 0;

                                        let starPercentage = (averageRating / 5) * 100; // Convert rating to percentage

                                        // Generate Star Icons
                                        let starIcons = "";
                                        for (let i = 1; i <= 5; i++) {
                                            if (i <= averageRating) {
                                                starIcons += `<i class="fas fa-star" style="color: gold;"></i>`; // Full star
                                            } else if (i - 0.5 <= averageRating) {
                                                starIcons += `<i class="fas fa-star-half-alt" style="color: gold;"></i>`; // Half star
                                            } else {
                                                starIcons += `<i class="far fa-star" style="color: gold;"></i>`; // Empty star
                                            }
                                        }

                                        // Inject into the Div
                                        ratingDiv.innerHTML = `
                        <span class="stars">${starIcons}</span>
                        <span class="percentage">${Math.round(starPercentage)}%</span>
                    `;
                                    });
                                });

                            </script>