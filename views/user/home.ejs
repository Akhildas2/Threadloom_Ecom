<%- include('../layouts/header.ejs') %>
    <%- include('../layouts/navbar.ejs') %>
        <%- include('../layouts/quickView.ejs') %>

            <body>

                <main class="main">
                    <!-- this for slider -->
                    <section class="home-slider position-relative pt-25 pb-20">
                        <div class="container">
                            <div class="row">
                                <div class="col-lg-9">
                                    <div class="position-relative">
                                        <div class="hero-slider-1 style-3 dot-style-1 dot-style-1-position-1">
                                            <div class="single-hero-slider single-animation-wrap">
                                                <div class="container">
                                                    <div class="slider-1-height-3 slider-animated-1">
                                                        <div class="hero-slider-content-2">
                                                            <h4 class="animated">Trade-In Offer</h4>
                                                            <h2 class="animated fw-900">Supper Value Deals</h2>
                                                            <h1 class="animated fw-900 text-brand">On All Products</h1>
                                                            <p class="animated">Save more with coupons & up to 70% off
                                                            </p>
                                                            <a class="animated btn btn-brush btn-brush-3"
                                                                href="shop-product-right.html"> Shop Now </a>
                                                        </div>
                                                        <div class="slider-img">
                                                            <img src="/imgs/slider/slider-4.png" alt="">
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="single-hero-slider single-animation-wrap">
                                                <div class="container">
                                                    <div class="slider-1-height-3 slider-animated-1">
                                                        <div class="hero-slider-content-2">
                                                            <h4 class="animated">Tech Promotions</h4>
                                                            <h2 class="animated fw-900">Tech Trending</h2>
                                                            <h1 class="animated fw-900 text-brand">Great Collection</h1>
                                                            <p class="animated">Save more with coupons & up to 20% off
                                                            </p>
                                                            <a class="animated btn btn-brush btn-brush-3"
                                                                href="shop-product-right.html"> Shop Now </a>
                                                        </div>
                                                        <div class="slider-img">
                                                            <img src="/imgs/slider/slider-5.png" alt="">
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="slider-arrow hero-slider-1-arrow style-3"></div>
                                    </div>
                                </div>
                                <div class="col-lg-3 d-md-none d-lg-block">
                                    <div class="banner-img banner-1 wow fadeIn  animated home-3">
                                        <img class="border-radius-10" src="/imgs/banner/banner-5.jpg" alt="">
                                        <div class="banner-text">
                                            <span>Accessories</span>
                                            <h4>Save 17% on <br>Autumn Hat</h4>
                                            <a href="shop-grid-right.html">Shop Now <i
                                                    class="fi-rs-arrow-right"></i></a>
                                        </div>
                                    </div>
                                    <div class="banner-img banner-2 wow fadeIn  animated mb-0">
                                        <img class="border-radius-10" src="/imgs/banner/banner-7.jpg" alt="">
                                        <div class="banner-text">
                                            <span>Smart Offer</span>
                                            <h4>Save 20% on <br>Eardrop</h4>
                                            <a href="shop-grid-right.html">Shop Now <i
                                                    class="fi-rs-arrow-right"></i></a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </section>
                    <!-- this for box iteam-->
                    <section class="featured section-padding">
                        <div class="container">
                            <div class="row">
                                <div class="col-lg-2 col-md-4 mb-md-3 mb-lg-0">
                                    <div class="banner-features wow fadeIn animated hover-up animated">
                                        <img src="/imgs/theme/icons/feature-1.png" alt="">
                                        <h4 class="bg-1">Free Shipping</h4>
                                    </div>
                                </div>
                                <div class="col-lg-2 col-md-4 mb-md-3 mb-lg-0">
                                    <div class="banner-features wow fadeIn animated hover-up animated">
                                        <img src="/imgs/theme/icons/feature-2.png" alt="">
                                        <h4 class="bg-3">Online Order</h4>
                                    </div>
                                </div>
                                <div class="col-lg-2 col-md-4 mb-md-3 mb-lg-0">
                                    <div class="banner-features wow fadeIn animated hover-up animated">
                                        <img src="/imgs/theme/icons/feature-3.png" alt="">
                                        <h4 class="bg-2">Save Money</h4>
                                    </div>
                                </div>
                                <div class="col-lg-2 col-md-4 mb-md-3 mb-lg-0">
                                    <div class="banner-features wow fadeIn animated hover-up animated">
                                        <img src="/imgs/theme/icons/feature-4.png" alt="">
                                        <h4 class="bg-4">Promotions</h4>
                                    </div>
                                </div>
                                <div class="col-lg-2 col-md-4 mb-md-3 mb-lg-0">
                                    <div class="banner-features wow fadeIn animated hover-up animated">
                                        <img src="/imgs/theme/icons/feature-5.png" alt="">
                                        <h4 class="bg-5">Happy Sell</h4>
                                    </div>
                                </div>
                                <div class="col-lg-2 col-md-4 mb-md-3 mb-lg-0">
                                    <div class="banner-features wow fadeIn animated hover-up animated">
                                        <img src="/imgs/theme/icons/feature-6.png" alt="">
                                        <h4 class="bg-6">24/7 Support</h4>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </section>
                    <!-- this for product-->
                    <section class="product-tabs section-padding wow fadeIn animated">
                        <div class="container">
                            <div class="tab-header d-flex flex-wrap justify-content-between align-items-center">
                                <ul class="nav nav-tabs" id="myTab" role="tablist">
                                    <li class="nav-item" role="presentation">
                                        <button class="nav-link active" id="nav-tab-one" data-bs-toggle="tab"
                                            data-bs-target="#tab-one" type="button" role="tab" aria-controls="tab-one"
                                            aria-selected="true">Featured</button>
                                    </li>
                                    <li class="nav-item" role="presentation">
                                        <button class="nav-link" id="nav-tab-two" data-bs-toggle="tab"
                                            data-bs-target="#tab-two" type="button" role="tab" aria-controls="tab-two"
                                            aria-selected="false">Popular</button>
                                    </li>
                                    <li class="nav-item" role="presentation">
                                        <button class="nav-link" id="nav-tab-three" data-bs-toggle="tab"
                                            data-bs-target="#tab-three" type="button" role="tab"
                                            aria-controls="tab-three" aria-selected="false">New Added</button>
                                    </li>
                                </ul>
                                <a href="/shop" class="view-more mt-2 mt-md-0 d-flex">View More Products<i
                                        class="fi-rs-angle-double-small-right"></i></a>
                            </div>

                            <div class="tab-content wow fadeIn animated" id="myTabContent">
                                <div class="tab-pane fade show active" id="tab-one" role="tabpanel"
                                    aria-labelledby="tab-one">
                                    <div class="row product-grid-4 m-2">
                                        <% for(let i=0; i < featuredProducts.length; i++) { %>
                                            <div class="col-lg-3 col-md-4 col-6 col-sm-6">
                                                <div class="product-cart-wrap mb-30">
                                                    <div class="product-img-action-wrap">
                                                        <div class="product-img product-img-zoom">
                                                            <a href="/productdetails/<%= featuredProducts[i]._id %>">
                                                                <img class="default-img"
                                                                    src="/uploads/product/resized/<%= featuredProducts[i].productImage[0] %>"
                                                                    alt="">
                                                                <img class="hover-img"
                                                                    src="/uploads/product/resized/<%= featuredProducts[i].productImage[1] %>"
                                                                    alt="">
                                                            </a>
                                                        </div>
                                                        <div class="product-action-1">

                                                            <a aria-label="Quick view"
                                                                class="action-btn hover-up quick-view-btn"
                                                                data-bs-toggle="modal" data-bs-target="#quickViewModal"
                                                                data-product='<%= JSON.stringify(featuredProducts[i]) %>'>
                                                                <i class="fi-rs-eye"></i>

                                                                <% if (userWishlist.some(item=>
                                                                    item.productId.equals(featuredProducts[i]._id))) {
                                                                    %>
                                                                    <a aria-label="Add To Wishlist" class="action-btn"
                                                                        style="background-color: red;"
                                                                        onclick="addToWishList('<%= featuredProducts[i]._id %>')"><i
                                                                            class="fi-rs-heart"></i></a>
                                                                    <% } else { %>
                                                                        <a aria-label="Add To Wishlist"
                                                                            class="action-btn hover-up"
                                                                            onclick="addToWishList('<%= featuredProducts[i]._id %>')"><i
                                                                                class="fi-rs-heart"></i></a>
                                                                        <% } %>
                                                                            <!-- <a aria-label="Compare"
                                                                            class="action-btn hover-up" href="#"><i
                                                                                class="fi-rs-shuffle"></i></a> -->
                                                        </div>
                                                        <div
                                                            class="product-badges product-badges-position product-badges-mrg">
                                                            <% if(featuredProducts[i].isNewArrival) { %><span
                                                                    class="new">New</span>
                                                                <% } %>
                                                                    <% if(featuredProducts[i].isHot) { %><span
                                                                            class="hot">Hot</span>
                                                                        <% } %>
                                                                            <% if(featuredProducts[i].isBestSeller) { %>
                                                                                <span class="best">Best Sell</span>
                                                                                <% } %>
                                                        </div>
                                                    </div>
                                                    <div class="product-content-wrap">
                                                        <div class="product-category">
                                                            <a href="/productdetails/<%= featuredProducts[i]._id %>">
                                                                <% if (featuredProducts[i].category) { %>
                                                                    <p>
                                                                        <%= featuredProducts[i].category.categoryName %>
                                                                    </p>
                                                                    <% } else { %>
                                                                        <p>Category: Not specified</p>
                                                                        <% } %>
                                                            </a>
                                                        </div>
                                                        <h2><a href="/productdetails/<%= featuredProducts[i]._id %>">
                                                                <%= featuredProducts[i].name %>
                                                            </a></h2>

                                                        <div class="rating-result"
                                                            data-rating="<%= featuredProducts[i].avgRating %>">
                                                            <span class="stars"></span>
                                                            <span class="percentage"></span>
                                                        </div>

                                                        <div class="product-card__price d-flex">
                                                            <% let discountedPrice=featuredProducts[i].price; %>
                                                                <% let hasDiscount=false; %>

                                                                    <% if (featuredProducts[i].offer) { %>
                                                                        <% const offer=featuredProducts[i].offer; %>
                                                                            <% if (new Date() <=new
                                                                                Date(offer.endingDate)) { %>
                                                                                <% discountedPrice -=discountedPrice *
                                                                                    (offer.discount / 100); %>
                                                                                    <% hasDiscount=true; %>
                                                                                        <% } %>
                                                                                            <% } else if
                                                                                                (featuredProducts[i].category.offer)
                                                                                                { %>
                                                                                                <% const
                                                                                                    categoryOffer=featuredProducts[i].category.offer;
                                                                                                    %>
                                                                                                    <% if (new Date()
                                                                                                        <=new
                                                                                                        Date(categoryOffer.endingDate))
                                                                                                        { %>
                                                                                                        <% discountedPrice
                                                                                                            -=discountedPrice
                                                                                                            *
                                                                                                            (categoryOffer.discount
                                                                                                            / 100); %>
                                                                                                            <% hasDiscount=true;
                                                                                                                %>
                                                                                                                <% } %>
                                                                                                                    <% }
                                                                                                                        %>

                                                                                                                        <% if
                                                                                                                            (hasDiscount)
                                                                                                                            {
                                                                                                                            %>
                                                                                                                            <span
                                                                                                                                class="money price">
                                                                                                                                <del>₹
                                                                                                                                    <%= featuredProducts[i].price.toFixed(2)
                                                                                                                                        %>
                                                                                                                                </del>
                                                                                                                                &nbsp;<span
                                                                                                                                    class="discounted-price"
                                                                                                                                    style="color: green;">₹
                                                                                                                                    <%= discountedPrice.toFixed(2)
                                                                                                                                        %>
                                                                                                                                </span>
                                                                                                                                &nbsp;<span
                                                                                                                                    class="discounted-percentage"
                                                                                                                                    style="color: red;">(
                                                                                                                                    <%= featuredProducts[i].offer
                                                                                                                                        ?
                                                                                                                                        featuredProducts[i].offer.discount
                                                                                                                                        :
                                                                                                                                        featuredProducts[i].category.offer.discount
                                                                                                                                        %>
                                                                                                                                        %
                                                                                                                                        off)
                                                                                                                                </span>
                                                                                                                            </span>
                                                                                                                            <% } else
                                                                                                                                {
                                                                                                                                %>
                                                                                                                                <span
                                                                                                                                    class="money price">₹
                                                                                                                                    <%= featuredProducts[i].price.toFixed(2)
                                                                                                                                        %>
                                                                                                                                </span>
                                                                                                                                <% }
                                                                                                                                    %>
                                                        </div>
                                                        <div class="product-action-1 show">
                                                            <button aria-label="Add To Cart" class="action-btn hover-up"
                                                                onclick="addToCart('<%= featuredProducts[i]._id %>', '<%= featuredProducts[i].name %>', '<%= featuredProducts[i].price %>')">
                                                                <i class="fi-rs-shopping-bag-add"></i>
                                                            </button>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <% } %>
                                    </div>
                                </div>

                                <div class="tab-pane fade show " id="tab-two" role="tabpanel" aria-labelledby="tab-two">
                                    <div class="row product-grid-4 m-2">
                                        <% for(let i=0; i < bestSellerProducts.length; i++) { %>
                                            <div class="col-lg-3 col-md-4 col-6 col-sm-6">
                                                <div class="product-cart-wrap mb-30">
                                                    <div class="product-img-action-wrap">
                                                        <div class="product-img product-img-zoom">
                                                            <a href="/productdetails/<%= bestSellerProducts[i]._id %>">
                                                                <img class="default-img"
                                                                    src="/uploads/product/resized/<%= bestSellerProducts[i].productImage[0] %>"
                                                                    alt="">
                                                                <img class="hover-img"
                                                                    src="/uploads/product/resized/<%= bestSellerProducts[i].productImage[1] %>"
                                                                    alt="">
                                                            </a>
                                                        </div>
                                                        <div class="product-action-1">

                                                            <a aria-label="Quick view"
                                                                class="action-btn hover-up quick-view-btn"
                                                                data-bs-toggle="modal" data-bs-target="#quickViewModal"
                                                                data-product='<%= JSON.stringify(bestSellerProducts[i]) %>'>
                                                                <i class="fi-rs-eye"></i>

                                                                <% if (userWishlist.some(item=>
                                                                    item.productId.equals(bestSellerProducts[i]._id))) {
                                                                    %>
                                                                    <a aria-label="Add To Wishlist" class="action-btn"
                                                                        style="background-color: red;"
                                                                        onclick="addToWishList('<%= bestSellerProducts[i]._id %>')"><i
                                                                            class="fi-rs-heart"></i></a>
                                                                    <% } else { %>
                                                                        <a aria-label="Add To Wishlist"
                                                                            class="action-btn hover-up"
                                                                            onclick="addToWishList('<%= bestSellerProducts[i]._id %>')"><i
                                                                                class="fi-rs-heart"></i></a>
                                                                        <% } %>
                                                                            <!-- <a aria-label="Compare"
                                                                                class="action-btn hover-up" href="#"><i
                                                                                    class="fi-rs-shuffle"></i></a> -->
                                                        </div>
                                                        <div
                                                            class="product-badges product-badges-position product-badges-mrg">
                                                            <% if(bestSellerProducts[i].isNewArrival) { %><span
                                                                    class="new">New</span>
                                                                <% } %>
                                                                    <% if(bestSellerProducts[i].isHot) { %><span
                                                                            class="hot">Hot</span>
                                                                        <% } %>
                                                                            <% if(bestSellerProducts[i].isBestSeller) {
                                                                                %>
                                                                                <span class="best">Best Sell</span>
                                                                                <% } %>
                                                        </div>
                                                    </div>
                                                    <div class="product-content-wrap">
                                                        <div class="product-category">
                                                            <a href="/productdetails/<%= bestSellerProducts[i]._id %>">
                                                                <% if (bestSellerProducts[i].category) { %>
                                                                    <p>
                                                                        <%= bestSellerProducts[i].category.categoryName
                                                                            %>
                                                                    </p>
                                                                    <% } else { %>
                                                                        <p>Category: Not specified</p>
                                                                        <% } %>
                                                            </a>
                                                        </div>
                                                        <h2><a href="/productdetails/<%= bestSellerProducts[i]._id %>">
                                                                <%= bestSellerProducts[i].name %>
                                                            </a></h2>

                                                        <div class="rating-result"
                                                            data-rating="<%= bestSellerProducts[i].avgRating %>">
                                                            <span class="stars"></span>
                                                            <span class="percentage"></span>
                                                        </div>

                                                        <div class="product-card__price d-flex">
                                                            <% let discountedPrice=bestSellerProducts[i].price; %>
                                                                <% let hasDiscount=false; %>

                                                                    <% if (bestSellerProducts[i].offer) { %>
                                                                        <% const offer=bestSellerProducts[i].offer; %>
                                                                            <% if (new Date() <=new
                                                                                Date(offer.endingDate)) { %>
                                                                                <% discountedPrice -=discountedPrice *
                                                                                    (offer.discount / 100); %>
                                                                                    <% hasDiscount=true; %>
                                                                                        <% } %>
                                                                                            <% } else if
                                                                                                (bestSellerProducts[i].category.offer)
                                                                                                { %>
                                                                                                <% const
                                                                                                    categoryOffer=bestSellerProducts[i].category.offer;
                                                                                                    %>
                                                                                                    <% if (new Date()
                                                                                                        <=new
                                                                                                        Date(categoryOffer.endingDate))
                                                                                                        { %>
                                                                                                        <% discountedPrice
                                                                                                            -=discountedPrice
                                                                                                            *
                                                                                                            (categoryOffer.discount
                                                                                                            / 100); %>
                                                                                                            <% hasDiscount=true;
                                                                                                                %>
                                                                                                                <% } %>
                                                                                                                    <% }
                                                                                                                        %>

                                                                                                                        <% if
                                                                                                                            (hasDiscount)
                                                                                                                            {
                                                                                                                            %>
                                                                                                                            <span
                                                                                                                                class="money price">
                                                                                                                                <del>₹
                                                                                                                                    <%= bestSellerProducts[i].price.toFixed(2)
                                                                                                                                        %>
                                                                                                                                </del>
                                                                                                                                &nbsp;<span
                                                                                                                                    class="discounted-price"
                                                                                                                                    style="color: green;">₹
                                                                                                                                    <%= discountedPrice.toFixed(2)
                                                                                                                                        %>
                                                                                                                                </span>
                                                                                                                                &nbsp;<span
                                                                                                                                    class="discounted-percentage"
                                                                                                                                    style="color: red;">(
                                                                                                                                    <%= bestSellerProducts[i].offer
                                                                                                                                        ?
                                                                                                                                        bestSellerProducts[i].offer.discount
                                                                                                                                        :
                                                                                                                                        bestSellerProducts[i].category.offer.discount
                                                                                                                                        %>
                                                                                                                                        %
                                                                                                                                        off)
                                                                                                                                </span>
                                                                                                                            </span>
                                                                                                                            <% } else
                                                                                                                                {
                                                                                                                                %>
                                                                                                                                <span
                                                                                                                                    class="money price">₹
                                                                                                                                    <%= bestSellerProducts[i].price.toFixed(2)
                                                                                                                                        %>
                                                                                                                                </span>
                                                                                                                                <% }
                                                                                                                                    %>
                                                        </div>
                                                        <div class="product-action-1 show">
                                                            <button aria-label="Add To Cart" class="action-btn hover-up"
                                                                onclick="addToCart('<%= bestSellerProducts[i]._id %>', '<%= bestSellerProducts[i].name %>', '<%= bestSellerProducts[i].price %>')">
                                                                <i class="fi-rs-shopping-bag-add"></i>
                                                            </button>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <% } %>
                                    </div>
                                </div>

                                <div class="tab-pane fade show " id="tab-three" role="tabpanel"
                                    aria-labelledby="tab-three">
                                    <div class="row product-grid-4 m-2">
                                        <% for(let i=0; i < newProducts.length; i++) { %>
                                            <div class="col-lg-3 col-md-4 col-6 col-sm-6">
                                                <div class="product-cart-wrap mb-30">
                                                    <div class="product-img-action-wrap">
                                                        <div class="product-img product-img-zoom">
                                                            <a href="/productdetails/<%= newProducts[i]._id %>">
                                                                <img class="default-img"
                                                                    src="/uploads/product/resized/<%= newProducts[i].productImage[0] %>"
                                                                    alt="">
                                                                <img class="hover-img"
                                                                    src="/uploads/product/resized/<%= newProducts[i].productImage[1] %>"
                                                                    alt="">
                                                            </a>
                                                        </div>
                                                        <div class="product-action-1">

                                                            <a aria-label="Quick view"
                                                                class="action-btn hover-up quick-view-btn"
                                                                data-bs-toggle="modal" data-bs-target="#quickViewModal"
                                                                data-product='<%= JSON.stringify(newProducts[i]) %>'>
                                                                <i class="fi-rs-eye"></i>
                                                            </a>

                                                            <% if (userWishlist.some(item=>
                                                                item.productId.equals(newProducts[i]._id))) { %>
                                                                <a aria-label="Add To Wishlist" class="action-btn"
                                                                    style="background-color: red;"
                                                                    onclick="addToWishList('<%= newProducts[i]._id %>')"><i
                                                                        class="fi-rs-heart"></i></a>
                                                                <% } else { %>
                                                                    <a aria-label="Add To Wishlist"
                                                                        class="action-btn hover-up"
                                                                        onclick="addToWishList('<%= newProducts[i]._id %>')"><i
                                                                            class="fi-rs-heart"></i></a>
                                                                    <% } %>
                                                                        <!-- <a aria-label="Compare"
                                                                            class="action-btn hover-up" href="#"><i
                                                                                class="fi-rs-shuffle"></i></a> -->
                                                        </div>
                                                        <div
                                                            class="product-badges product-badges-position product-badges-mrg">
                                                            <% if(newProducts[i].isNewArrival) { %><span
                                                                    class="new">New</span>
                                                                <% } %>
                                                                    <% if(newProducts[i].isHot) { %><span
                                                                            class="hot">Hot</span>
                                                                        <% } %>
                                                                            <% if(newProducts[i].isBestSeller) { %>
                                                                                <span class="best">Best Sell</span>
                                                                                <% } %>
                                                        </div>
                                                    </div>
                                                    <div class="product-content-wrap">
                                                        <div class="product-category">
                                                            <a href="/productdetails/<%= newProducts[i]._id %>">
                                                                <% if (newProducts[i].category) { %>
                                                                    <p>
                                                                        <%= featuredProducts[i].category.categoryName %>
                                                                    </p>
                                                                    <% } else { %>
                                                                        <p>Category: Not specified</p>
                                                                        <% } %>
                                                            </a>
                                                        </div>
                                                        <h2><a href="/productdetails/<%= newProducts[i]._id %>">
                                                                <%= newProducts[i].name %>
                                                            </a></h2>

                                                        <div class="rating-result"
                                                            data-rating="<%= newProducts[i].avgRating %>">
                                                            <span class="stars"></span>
                                                            <span class="percentage"></span>
                                                        </div>

                                                        <div class="product-card__price d-flex">
                                                            <% let discountedPrice=newProducts[i].price; %>
                                                                <% let hasDiscount=false; %>

                                                                    <% if (newProducts[i].offer) { %>
                                                                        <% const offer=newProducts[i].offer; %>
                                                                            <% if (new Date() <=new
                                                                                Date(offer.endingDate)) { %>
                                                                                <% discountedPrice -=discountedPrice *
                                                                                    (offer.discount / 100); %>
                                                                                    <% hasDiscount=true; %>
                                                                                        <% } %>
                                                                                            <% } else if
                                                                                                (newProducts[i].category.offer)
                                                                                                { %>
                                                                                                <% const
                                                                                                    categoryOffer=newProducts[i].category.offer;
                                                                                                    %>
                                                                                                    <% if (new Date()
                                                                                                        <=new
                                                                                                        Date(categoryOffer.endingDate))
                                                                                                        { %>
                                                                                                        <% discountedPrice
                                                                                                            -=discountedPrice
                                                                                                            *
                                                                                                            (categoryOffer.discount
                                                                                                            / 100); %>
                                                                                                            <% hasDiscount=true;
                                                                                                                %>
                                                                                                                <% } %>
                                                                                                                    <% }
                                                                                                                        %>

                                                                                                                        <% if
                                                                                                                            (hasDiscount)
                                                                                                                            {
                                                                                                                            %>
                                                                                                                            <span
                                                                                                                                class="money price">
                                                                                                                                <del>₹
                                                                                                                                    <%= newProducts[i].price.toFixed(2)
                                                                                                                                        %>
                                                                                                                                </del>
                                                                                                                                &nbsp;<span
                                                                                                                                    class="discounted-price"
                                                                                                                                    style="color: green;">₹
                                                                                                                                    <%= discountedPrice.toFixed(2)
                                                                                                                                        %>
                                                                                                                                </span>
                                                                                                                                &nbsp;<span
                                                                                                                                    class="discounted-percentage"
                                                                                                                                    style="color: red;">(
                                                                                                                                    <%= newProducts[i].offer
                                                                                                                                        ?
                                                                                                                                        newProducts[i].offer.discount
                                                                                                                                        :
                                                                                                                                        newProducts[i].category.offer.discount
                                                                                                                                        %>
                                                                                                                                        %
                                                                                                                                        off)
                                                                                                                                </span>
                                                                                                                            </span>
                                                                                                                            <% } else
                                                                                                                                {
                                                                                                                                %>
                                                                                                                                <span
                                                                                                                                    class="money price">₹
                                                                                                                                    <%= newProducts[i].price.toFixed(2)
                                                                                                                                        %>
                                                                                                                                </span>
                                                                                                                                <% }
                                                                                                                                    %>
                                                        </div>
                                                        <div class="product-action-1 show">
                                                            <button aria-label="Add To Cart" class="action-btn hover-up"
                                                                onclick="addToCart('<%= newProducts[i]._id %>', '<%= newProducts[i].name %>', '<%= newProducts[i].price %>')">
                                                                <i class="fi-rs-shopping-bag-add"></i>
                                                            </button>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <% } %>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </section>


                    <!-- <section class="banner-2 section-padding pb-0">
            <div class="container">
                <div class="banner-img banner-big wow fadeIn animated f-none">
                    <img src="/imgs/banner/banner-4.png" alt="">
                    <div class="banner-text d-md-block d-none">
                        <h4 class="mb-15 mt-40 text-brand">Repair Services</h4>
                        <h1 class="fw-600 mb-20">We're an Apple <br>Authorised Service Provider</h1>
                        <a href="shop-grid-right.html" class="btn">Learn More <i class="fi-rs-arrow-right"></i></a>
                    </div>
                </div>
            </div>
        </section> -->


                    <section class="popular-categories section-padding mt-15 mb-100">
                        <div class="container wow fadeIn animated">
                            <h3 class="section-title mb-20"><span>Popular</span> Categories</h3>
                            <div class="carausel-6-columns-cover position-relative">
                                <div class="slider-arrow slider-arrow-2 carausel-6-columns-arrow"
                                    id="carausel-6-columns-arrows"></div>
                                <div class="carausel-6-columns" id="carausel-6-columns">
                                    <% categories.forEach(category=> { %>
                                        <div class="card-1">
                                            <figure class=" img-hover-scale overflow-hidden">
                                                <a href="/shop?category=<%= category.categoryName %>">
                                                    <img src="uploads/category/resized/<%= category.categoryPhoto %>"
                                                        alt="<%= category.categoryName %>"></a>
                                            </figure>
                                            <h5><a href="/shop?category=<%= category.categoryName %>">
                                                    <%= category.categoryName %>

                                                </a></h5>
                                        </div>
                                        <% }) %>
                                </div>
                            </div>
                        </div>
                    </section>


                    <!-- <section class="banners mb-20">
            <div class="container">
                <div class="row">
                    <div class="col-lg-4 col-md-6">
                        <div class="banner-img wow fadeIn animated">
                            <img src="/imgs/banner/banner-1.png" alt="">
                            <div class="banner-text">
                                <span>Smart Offer</span>
                                <h4>Save 20% on <br>Woman Bag</h4>
                                <a href="shop-grid-right.html">Shop Now <i class="fi-rs-arrow-right"></i></a>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-4 col-md-6">
                        <div class="banner-img wow fadeIn animated">
                            <img src="/imgs/banner/banner-2.png" alt="">
                            <div class="banner-text">
                                <span>Sale off</span>
                                <h4>Great Summer <br>Collection</h4>
                                <a href="shop-grid-right.html">Shop Now <i class="fi-rs-arrow-right"></i></a>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-4 d-md-none d-lg-flex">
                        <div class="banner-img wow fadeIn animated  mb-sm-0">
                            <img src="/imgs/banner/banner-3.png" alt="">
                            <div class="banner-text">
                                <span>New Arrivals</span>
                                <h4>Shop Today’s <br>Deals & Offers</h4>
                                <a href="shop-grid-right.html">Shop Now <i class="fi-rs-arrow-right"></i></a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        <section class="section-padding">
            <div class="container pb-20">
                <h3 class="section-title mb-20 wow fadeIn animated"><span>Featured</span> Brands</h3>
                <div class="carausel-6-columns-cover position-relative wow fadeIn animated">
                    <div class="slider-arrow slider-arrow-2 carausel-6-columns-arrow" id="carausel-6-columns-3-arrows"></div>
                    <div class="carausel-6-columns text-center" id="carausel-6-columns-3">
                        <div class="brand-logo">
                            <img class="img-grey-hover" src="/imgs/banner/brand-1.png" alt="">
                        </div>
                        <div class="brand-logo">
                            <img class="img-grey-hover" src="/imgs/banner/brand-2.png" alt="">
                        </div>
                        <div class="brand-logo">
                            <img class="img-grey-hover" src="/imgs/banner/brand-3.png" alt="">
                        </div>
                        <div class="brand-logo">
                            <img class="img-grey-hover" src="/imgs/banner/brand-4.png" alt="">
                        </div>
                        <div class="brand-logo">
                            <img class="img-grey-hover" src="/imgs/banner/brand-5.png" alt="">
                        </div>
                        <div class="brand-logo">
                            <img class="img-grey-hover" src="/imgs/banner/brand-6.png" alt="">
                        </div>
                        <div class="brand-logo">
                            <img class="img-grey-hover" src="/imgs/banner/brand-3.png" alt="">
                        </div>
                    </div>
                </div>
            </div>
        </section> -->
                </main>
                <%- include('../layouts/footer.ejs') %>
                    <%- include('../layouts/preloader.ejs') %>
                        <%- include('../layouts/script.ejs') %>
                            <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

                            <script>
                                function addToCart(productId, name, price) {
                                    // Assuming you want to add 1 quantity by default
                                    const quantity = 1;

                                    fetch('/cart/addToCart/' + productId, {
                                        method: 'POST',
                                        headers: {
                                            'Content-Type': 'application/json',
                                        },
                                        body: JSON.stringify({ productId, name, quantity, price }),
                                    })
                                        .then(response => {
                                            if (response.redirected) {
                                                return Swal.fire({
                                                    title: 'Login Required',
                                                    text: 'You must be logged in to add items to your cart.',
                                                    icon: 'warning',
                                                    showCancelButton: true,
                                                    confirmButtonText: 'Login',
                                                    cancelButtonText: 'Cancel',
                                                }).then((result) => {
                                                    if (result.isConfirmed) {
                                                        window.location.href = '/login';
                                                    } else {
                                                        throw new Error('Action cancelled');
                                                    }
                                                });
                                            }
                                            return response.json();
                                        })

                                        .then(data => {
                                            if (data.status) {
                                                // Show a success message using SweetAlert2
                                                const Toast = Swal.mixin({
                                                    toast: true,
                                                    position: "top-end",
                                                    showConfirmButton: false,
                                                    timer: 3000,
                                                    timerProgressBar: true,
                                                    didOpen: (toast) => {
                                                        toast.onmouseenter = Swal.stopTimer;
                                                        toast.onmouseleave = Swal.resumeTimer;
                                                    }
                                                });
                                                Toast.fire({
                                                    icon: "success",
                                                    title: 'Success!',
                                                    text: data.message,
                                                });
                                                setTimeout(() => {
                                                    location.reload();
                                                }, 3000);
                                            } else {
                                                // Handle errors
                                                Swal.fire({
                                                    title: 'Error!',
                                                    text: data.message,
                                                    icon: 'error',
                                                });
                                            }
                                        })
                                        .catch(err => {
                                            if (!err.data.success) {
                                                Swal.fire({
                                                    icon: 'error',
                                                    title: 'Error',
                                                    text: err.response.data.message,
                                                });
                                            } else {
                                                console.error(err);
                                            }
                                        });
                                }


                                function addToWishList(productId) {


                                    fetch('/wishList/addTowishList/' + productId, {
                                        method: 'POST',
                                        headers: {
                                            'Content-Type': 'application/json',
                                        },
                                        body: JSON.stringify({ productId }),
                                    })

                                        .then(response => {
                                            if (response.redirected) {
                                                return Swal.fire({
                                                    title: 'Login Required',
                                                    text: 'You must be logged in to add items to your Wishlist.',
                                                    icon: 'warning',
                                                    showCancelButton: true,
                                                    confirmButtonText: 'Login',
                                                    cancelButtonText: 'Cancel',
                                                }).then((result) => {
                                                    if (result.isConfirmed) {
                                                        window.location.href = '/login';
                                                    } else {
                                                        throw new Error('Action cancelled');
                                                    }
                                                });
                                            }
                                            return response.json();
                                        })

                                        .then(data => {
                                            if (data.status) {
                                                // Show a success message using SweetAlert2
                                                const Toast = Swal.mixin({
                                                    toast: true,
                                                    position: "top-end",
                                                    showConfirmButton: false,
                                                    timer: 3000,
                                                    timerProgressBar: true,
                                                    didOpen: (toast) => {
                                                        toast.onmouseenter = Swal.stopTimer;
                                                        toast.onmouseleave = Swal.resumeTimer;
                                                    }
                                                });
                                                Toast.fire({
                                                    icon: "success",
                                                    title: 'Success!',
                                                    text: data.message,
                                                });
                                                setTimeout(() => {
                                                    location.reload();
                                                }, 3000);
                                            } else {
                                                // Handle errors
                                                Swal.fire({
                                                    title: 'Error!',
                                                    text: data.message,
                                                    icon: 'error',
                                                });
                                            }
                                        })
                                        .catch(err => {
                                            if (!err.data.success) {
                                                Swal.fire({
                                                    icon: 'error',
                                                    title: 'Error',
                                                    text: err.response.data.message,
                                                });
                                            } else {
                                                console.error(err);
                                            }
                                        });
                                }

                                document.addEventListener("DOMContentLoaded", function () {
                                    document.querySelectorAll(".quick-view-btn").forEach(button => {
                                        button.addEventListener("click", function () {
                                            let product = JSON.parse(this.getAttribute("data-product"));

                                            // Populate Product Info
                                            document.getElementById("quickViewName").innerText = product.name;
                                            document.getElementById("quickViewCategory").innerText = product.category.categoryName;
                                            document.getElementById("quickViewBrand").innerText = product.brand;
                                            document.getElementById("quickViewGender").innerText = product.gender;
                                            document.getElementById("quickViewSize").innerText = product.size;
                                            document.getElementById("description").innerText = product.description;

                                            // Assume product is the object received (and it includes offer and category.offer if available)
                                            let discountedPrice = product.price;
                                            let hasDiscount = false;

                                            if (product.offer) {
                                                const offer = product.offer;
                                                const currentDate = new Date();
                                                const offerEndDate = new Date(offer.endingDate);
                                                if (currentDate <= offerEndDate) {
                                                    discountedPrice = discountedPrice - (discountedPrice * (offer.discount / 100));
                                                    hasDiscount = true;
                                                }
                                            } else if (product.category && product.category.offer) {
                                                const categoryOffer = product.category.offer;
                                                const currentDate = new Date();
                                                const offerEndDate = new Date(categoryOffer.endingDate);
                                                if (currentDate <= offerEndDate) {
                                                    discountedPrice = discountedPrice - (discountedPrice * (categoryOffer.discount / 100));
                                                    hasDiscount = true;
                                                }
                                            }

                                            const priceElement = document.getElementById("quickViewPrice");

                                            if (hasDiscount) {
                                                priceElement.innerHTML = `
                                <span class="money price">
                                <ins><del> ${product.price.toFixed(2)}</del></ins>
                                <ins style="margin-left: 20px;">
                                    <span class="discounted-price" style="color: green;"> ${discountedPrice.toFixed(2)}</span>
                                </ins>
                                <ins style="margin-left: 20px;">
                                    <span class="discount-percentage" style="color: red;">
                                    (${product.offer ? product.offer.discount : product.category.offer.discount}% off)
                                    </span>
                                </ins>
                                </span>
                            `;
                                            } else {
                                                priceElement.innerHTML = `<ins><span class="money price"> ${product.price.toFixed(2)}</span></ins>`;
                                            }

                                            // Stock status
                                            let stockDiv = document.getElementById("quickViewStock");
                                            stockDiv.innerHTML = product.stockCount > 0
                                                ? `<span class="badge bg-success">In Stock</span>`
                                                : `<span class="badge bg-danger">Out of Stock</span>`;

                                            // Handle Ratings and Reviews
                                            let ratingDiv = document.getElementById("quickViewRating");
                                            let averageRating = product.avgRating || 0;
                                            let totalRatings = product.totalRatings || 0;
                                            let totalReviews = product.totalReviews || 0;

                                            let ratingColor = averageRating >= 3 ? "#4CAF50" : "#F44336"; // Green if rating >= 3, Red otherwise

                                            ratingDiv.innerHTML = `
                            <div class="product-rate-cover text-end">
                                <strong>
                                    <span class="font-small m-2" style="background-color: ${ratingColor}; color: white; padding: 3px 6px; border-radius: 4px;">
                                        ${averageRating.toFixed(1)} ★
                                    </span>
                                </strong> |
                                <span class="font-small m-2 text-muted">${totalRatings} Ratings</span> |
                                <span class="font-small m-2 text-muted">${totalReviews} Reviews</span>
                            </div>
                         `;

                                            // Get Image Containers
                                            let imageContainer = document.getElementById("quickViewImages");
                                            let thumbnailContainer = document.getElementById("quickViewThumbnails");

                                            // Clear Previous Content
                                            imageContainer.innerHTML = "";
                                            thumbnailContainer.innerHTML = "";

                                            if (product.productImage.length > 0) {
                                                product.productImage.forEach((image, index) => {
                                                    let mainSlide = `
                                    <figure class="border-radius-10">
                                    <img src="/uploads/product/resized/${image}" alt="${product.name}" style="width: 100%; height: 100%; object-fit: cover;">
                                    </figure>
                                `;
                                                    imageContainer.innerHTML += mainSlide;

                                                    let thumbSlide = `
                                    <div class="thumbnail">
                                    <img src="/uploads/product/resized/${image}" alt="${product.name}" style="width: 100px; height: 100px; object-fit: fill;">
                                    </div>
                                `;
                                                    thumbnailContainer.innerHTML += thumbSlide;
                                                });
                                            }

                                            // Show the modal (if not already being triggered by another mechanism)
                                            $('#quickViewModal').modal('show');
                                        });
                                    });

                                    // Initialize the slider after the modal is fully shown
                                    $('#quickViewModal').on('shown.bs.modal', function () {
                                        // Initialize the slider for the modal gallery
                                        window.initSlickSlider($('#quickViewModal .detail-gallery'));
                                    });

                                    $('#quickViewModal').on('hidden.bs.modal', function () {
                                        var $modalGallery = $(this).find('.detail-gallery');
                                        var $productImageSlider = $modalGallery.find('.product-image-slider');
                                        var $thumbnailSlider = $modalGallery.find('.slider-nav-thumbnails');

                                        // Unslick the sliders if initialized
                                        if ($productImageSlider.hasClass('slick-initialized')) {
                                            $productImageSlider.slick('unslick');
                                        }
                                        if ($thumbnailSlider.hasClass('slick-initialized')) {
                                            $thumbnailSlider.slick('unslick');
                                        }

                                        // Optionally, clear the content if needed
                                        $productImageSlider.empty();
                                        $thumbnailSlider.empty();
                                    });

                                });

                                document.addEventListener("DOMContentLoaded", function () {
                                    document.querySelectorAll(".rating-result").forEach(ratingDiv => {
                                        let averageRating = parseFloat(ratingDiv.getAttribute("data-rating")) || 0;

                                        let starPercentage = (averageRating / 5) * 100; // Convert rating to percentage

                                        // Generate Star Icons
                                        let starIcons = "";
                                        for (let i = 1; i <= 5; i++) {
                                            if (i <= averageRating) {
                                                starIcons += `<i class="fas fa-star" style="color: gold;"></i>`; // Full star
                                            } else if (i - 0.5 <= averageRating) {
                                                starIcons += `<i class="fas fa-star-half-alt" style="color: gold;"></i>`; // Half star
                                            } else {
                                                starIcons += `<i class="far fa-star" style="color: gold;"></i>`; // Empty star
                                            }
                                        }

                                        // Inject into the Div
                                        ratingDiv.innerHTML = `
                        <span class="stars">${starIcons}</span>
                        <span class="percentage">${Math.round(starPercentage)}%</span>
                    `;
                                    });
                                });

                            </script>